---
title: "examen_2_R"
author: "Benjamín Gutiérrez Padua. C4F813"
format: 
  html:
    self-contained: true
    toc: true
    number-sections: true
    code-fold: show
    df-print: paged
    smooth-scroll: true
    theme: cosmo
  pdf: 
    number-sections: true
    pdf-engine: pdflatex
    mainfront: Arial
    papersize: letter
    geometry: margin=1in
editor: visual
---

# Resolución de examen (R)

Benjamín Gutiérrez Padua. C4F813.

Enlace a repositorio de github: <https://github.com/ThePadua/Examen_2_CA0204_C4F813_BenjaminGutierrezPadua.git>

-   Librerías de trabajo:

```{r}
#Se importan librerias
library("dplyr");library("ggplot2")
```

-   Importar conjunto de datos:

```{r}
# Se importa el data set de trabajo
moras <- read.delim('../raw_data/moras.txt', sep = "," ,header = T)
```

**1) Resumen cinco números columnas numéricas.**

```{r}
#Conversión a numeric de Salario mediante depuración en columnas, con verificacion rigurosa en la conversion (problema de diferente media con la de excel solucionado)
moras <- moras %>%
  mutate(
    SALARIO_chr   = as.character(SALARIO), ##Lea character       
    SALARIO_limp  = gsub("[^0-9]", "", SALARIO_chr),       ##Remover si no es digito
    SALARIO_limp  = ifelse(SALARIO_limp == "", NA, SALARIO_limp),
    SALARIO_numeric   = as.numeric(SALARIO_limp)
  )

sum(is.na(moras$SALARIO_numeric)) #Congruente con lo observado 
sum(is.na(moras$EDAD))## Congruente observado 
sum(trimws(moras$TIPO_ASEGURAMIENTO) == "") ## Congruente observado

```

```{r}
## Edad
resumen_edad <- moras %>% 
  summarise(
    min = min(EDAD, na.rm =T),
    max = max(EDAD, na.rm = T),
    mediana = median(EDAD,na.rm = T),
    promedio_edad = mean(EDAD,na.rm = T),
    Cuartil_1 = quantile(EDAD,0.25, na.rm = T),
    Cuartil_3 = quantile(EDAD,0.75, na.rm = T)
  )
  
## Salario
resumen_salario <- moras %>% 
  summarise(
    min = min(SALARIO_numeric, na.rm =T),
    max = max(SALARIO_numeric, na.rm = T),
    mediana = median(SALARIO_numeric,na.rm = T),
    promedio = mean(SALARIO_numeric,na.rm = T),
    Cuartil_1 = quantile(SALARIO_numeric,0.25, na.rm = T),
    Cuartil_3 = quantile(SALARIO_numeric,0.75, na.rm = T)
  )

```

Se imprime resumen de 5 (6) números

-   Salario

```{r}
print(resumen_salario)
```

-   Edad

```{r}
print(resumen_edad)
```

**2) Prueba Z-Score**

Se aplica prueba Z-Score para determinar si son atipicos los valores existentes

```{r}
#Desviacion estandar de la edad 
sd_edad <- sd(moras$EDAD, na.rm = T)
#Desviacion estandar del salario
sd_salario <- sd(moras$SALARIO_numeric, na.rm = T)
#Prueba Z-Score
moras<- moras %>%
  mutate(
    Z_Score_edad = abs(((EDAD - resumen_edad$promedio_edad ) / sd_edad)),
    Z_Score_salario = abs(((SALARIO_numeric - resumen_salario$promedio) / sd_salario))
  )

#Indicar es atipico 
moras <- moras %>% 
  mutate(
    Atipico_edad = if_else(Z_Score_edad > 1.96, "Sí","No"), 
    Atipico_salario = if_else(Z_Score_salario > 1.96, "Si", "No")
  )
```

**3) Detección de valores ausentes para cada columna**

```{r}
## Con la finalidad de simplifcar se calculara el porcentaje de ausentes solo para los que se conoce por desarrollo previo en inciso de Excel que habian ausentes 
#Ausentes Tipo_Aseguramiento
porcentaje_na_Aseguramiento <- (sum(trimws(moras$TIPO_ASEGURAMIENTO) == "") / length(moras$TIPO_ASEGURAMIENTO)) * 100
#Ausentes en Edad
porcentaje_na_Edad <- (sum(is.na(moras$EDAD))/length(moras$EDAD))*100

#Ausentes en Salario

porcentaje_na_Salario <- (sum(is.na(moras$SALARIO_numeric))/length(moras$EDAD))*100
```

**4) Imputación valores faltantes**

Estrategias determinadas a emplear

**Salario** : Dado que el porcentaje de ausentes es menor al 1% , se considera conveniente realizar la imputación mediante la asignación de la mediana que es el valor medio de los datos ordenados, de modo que no se infla el valor imputado como podría darse al seleccionar el promedio que canaliza los valores que más se puedan desviar, y de esta forma se imputa sin generar tergiversaciones.

**Edad**: De manera análoga al Salario, se va a optar por imputar respecto a la Mediana , como el valor de referencia que no tergiversa los datos

**Aseguramiento**: Para este componente se ha identificado que los ausentes son el ID 72 y el ID 151 que correspondenden respectivamente al sector público y privado respectivamente, por lo que se optará por imputar tomando de referencia la moda considerando la moda del tipo de aseguramiento respecto a la categoría sector, es decir: por ejemplo si la moda de los que cumplen estar en la categoría sector privado es asalariado, entonces imputar el tipo de aseguramiento por asalariado, y dado que el porcentaje de ausentes son menor al 0.05 % y resulta que sus Z-score respectivos indicaron que no son atípicos (para ninguna de las dos evaluaciones) esto no supondrá una alteración significativa del conjunto de datos al imputarlo de esta manera

```{r}
## Se imputa simpleficando el analisis de categoria de sector publico o privado , dado que conocemos es Asalariado
moras <- moras %>% 
  mutate(
    Salario_imputado = if_else(is.na(SALARIO_numeric),resumen_salario$mediana, SALARIO_numeric),
    Edad_imputado = if_else(is.na(EDAD), resumen_edad$mediana, EDAD),
    TIPO_ASEGURAMIENTO_imputado = if_else(trimws(TIPO_ASEGURAMIENTO) == "", "ASALARIADO", TIPO_ASEGURAMIENTO)
  )

```

**5)**

```{r}
## Grafica para representar cantidad de invdividuos por categoria
##Tabla de frecuencias
frecuencia_categoria <- moras %>%
  count(TIPO_ASEGURAMIENTO_imputado, SECTOR, name = "frecuencia")

ggplot(frecuencia_categoria, aes (x = SECTOR, y = frecuencia, fill = SECTOR)) +
  geom_col()+
  facet_wrap(~ TIPO_ASEGURAMIENTO_imputado) +
  labs(
    title = "Distribución absoluta individuos por categoría",
    
  ) +
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
  

```

Análisis de los resultados observados

En la presente gráfica se muestra la distribución absoluta de los cinco mil individuos del conjunto de datos en cada una de las respectivas categorías como los son Asalariado, Asegurado Voluntario, Convenios Especiales tanto como de Asegurado Voluntario y Trabajador independiente , pensionado en su propio sistema y como trabajador independiente, del cual se extraen las siguientes conclusiones.

Asalariado: Suponen la categoría en la que mayor concentración de invidivuos pertenece tanto para el Sector público como el privado.

Asegurado voluntario: No se observa ningún trabajador del sector público en esta categoría, es la tercera de más concentración para los miembros del sector privado.

Convenio Especial- Asegurado Voluntario: Se puede denotar que es la categoría de tipo de asegurado en la que menor cantidad de población hay concentrada de la muestra tomada, nuev.amente no se observa ningún trabajador del sector público en esta categoría.

Convenio Especial- Trabajadores Independientes: Es la segunda categoría de menor concetración de población de toda la muestra tomada (en términos absolutos, es decir tanto privado como público en conjunto) y no se precisan a individuos del sector privado en esta categoría.

Pensionado en su Propio Sistema: Tercera categoría en la que menos concetración de individuos hay en terminos absolutos y ninguna de las observaciones corresponde al sector privado, esta muestra puede corresponder a individuos que se encuentren en el sistema de la Junta de Pensiones del Magisterio Nacional (JUPEMA) o bien del fondo de Jubilaciones y Pensiones del Poder Judicial.

Trabajador Independiente: Es la categoría de segunda mayor concentración para los individuos del sector privado y no se observa ningún individuo del sector público en este componente.

En general: La representación gráfica permite inferir que la mayor proporción de la población son asalariados (dependen de un patrono) y que en términos generales hay una mayor concentración de inviduos en el sector privado que público.

**6)** **Representación porcentual entre morosos y no morosos por categoría**

sum(trimws(moras\$Atipico_edad) == "Sí", na.rm = T) \## Congruente observado

sum(trimws(moras\$Atipico_salario) == "Si", na.rm = T) \#

```{r}
## Reordeno el conjunto de datos 
moras <- moras %>%
  mutate(
    MOROSO = factor(INDICADOR_MOROSO, levels = c("Sí", "No"))
  )
# Se agrupa por la categoria de asegurados a morosos y no morosos
frecuencia_morosidad <- moras %>% 
  group_by(TIPO_ASEGURAMIENTO, INDICADOR_MOROSO) %>% 
  summarise(n = n(), .groups = "drop")


ggplot(frecuencia_morosidad,
       aes(x = TIPO_ASEGURAMIENTO,
           y = n,
           fill = INDICADOR_MOROSO)) +
  geom_col(position = "fill") +  # barras apiladas al 100%
  scale_y_continuous() +
  labs(
    title = "Distribución porcentual de morosos según tipo de aseguramiento",
    x = "Tipo de aseguramiento",
    y = "Porcentaje",
    fill = "Moroso"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1)
  ) 
## Nota debo corregir barra de la izquierda dado que se genero por error (na? o vacio?) , revisar...
```
